# Lab: Reflected XSS with AngularJS sandbox escape without strings

EXPERT

This lab uses AngularJS in an unusual way where the `$eval` function is not available and you will be unable to use any strings in AngularJS.

To solve the lab, perform a cross-site scripting attack that escapes the sandbox and executes the `alert` function without using the `$eval` function.

Access the lab: https://portswigger.net/academy/labs/launch/d82e3a0ca07b096a36c320bdaf6f10ac92869a49f98d1adfd16b4ffdc05390f1?referrer=%2fweb-security%2fcross-site-scripting%2fcontexts%2fclient-side-template-injection%2flab-angular-sandbox-escape-without-strings

Solution

Paste the following URL into your browser, replacing `YOUR-LAB-ID` with your lab host (the lab's domain prefix):

```
https://YOUR-LAB-ID.web-security-academy.net/?search=1&toString().constructor.prototype.charAt%3d[].join;[1]|orderBy:toString().constructor.fromCharCode(120,61,97,108,101,114,116,40,49,41)=1
```

Explanation

{% stepper %}
{% step %}
### Create strings without quotes

Use `toString()` on objects to obtain a string representation without using quotes. This enables access to the `String` constructor and prototype without literal string usage.
{% endstep %}

{% step %}
### Break the AngularJS sandbox

Overwrite `toString().constructor.prototype.charAt` (the `charAt` function on string prototype) by assigning it to `[].join`. Replacing `charAt` with a harmless function effectively disables AngularJS's sandbox checks that rely on string indexing/inspection.
{% endstep %}

{% step %}
### Use a filter to evaluate the payload

Pass an array to the `orderBy` filter and set its argument via another `toString()`-derived string. Use `String.fromCharCode(...)` to generate the payload characters without quotes.
{% endstep %}

{% step %}
### Generate and execute the payload

The `fromCharCode` call constructs `x=alert(1)` from character codes (120,61,97,108,101,114,116,40,49,41). Because `charAt` was overwritten, AngularJS accepts and executes the resulting expression, triggering `alert(1)`.
{% endstep %}
{% endstepper %}

Community solutions

* Michael Sommer â€” Reflected XSS with AngularJS sandbox escape without strings (Video solution)
  * Video: https://www.youtube.com/watch?v=pln9RRbB5CI
  * Channel: https://www.youtube.com/channel/UCfchiSwWibUyS2USW9NQSWw?embeds\_referring\_euri=https%3A%2F%2Fportswigger.net%2F\&embeds\_referring\_origin=https%3A%2F%2Fportswigger.net

Note: The exploit relies solely on creating strings and function references without using string literals or `$eval`, and on subverting AngularJS sandbox checks by replacing a string prototype method.
