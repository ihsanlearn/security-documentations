# Password-Based Login

***

#### Username enumeration via different response

Ini terjadi ketika kita mencoba bruteforce username lalu mendapatkan response yang berbeda, apabila suatu username tidak valid maka mendapat response "Invalid Username". Akan tetapi jika mendapat response selain itu maka ada kemungkinan username itu valid akan tetapi password salah contohnya mendapat response "Invalid Password". Maka dari sini kita tinggal bruteforce password karena username sudah dipastikan valid.

#### Username enumeration via subtly different response

Sering terjadi bahwa developer memberikan response yang berbeda pada suatu logic yang sedikit berbeda, contohnya:

```javascript
if (usernameInput == usernameDB) {
    if (passwordInput == passwordDB) {
            console.log("Login Success")
        } else {
            console.log("Invalid username or password.")
        }
} else {
    console.log("Invalid username or password")
}
```

Seperti yang terlihat pada kode di atas, terdapat sedikit perbedaan ketika username tidak valid dan username benar tetapi password salah. Dapat dilihat ketika username tidak valid maka diakhir response text tidak terdapat titik, tetapi ketika username valid maka akan masuk diblock kode yang ketika password salah maka responsenya terdapat titik. Ini hanya sangat hampir tidak terlihat perbedaannya.

#### Username enumeration via response timing

Perhatikan pseudo code implementasi autentikasi dibawah ini:

```javascript
if (usernameInput == usernameDB) {
    const passwordInput
    const passwordHash = hash(passwordInput)
    if (passwordHash == passwordHashDB) {
            console.log("Login Success")
        } else {
            console.log("Invalid username or password.")
        }
}
```

Contoh kode itu dapat menjadi indikasi bahwa sebuah username itu valid maka akan membutuhkan lebih banyak waktu untuk merespon karena ketika username divalidasi dan valid maka akan melanjutkan proses hash password terlebih lagi ketika input password panjang.

***

#### Broken Bruteforce Protection using IP Block

Ketika sebuah website menggunakan perlindungan IP Block untuk serangan bruteforce, hal ini dapat dibypass melalui beberapa cara seperti menggunakan header dibawah ini:

```html
X-Forwarded-For
X-Originating-IP
X-Remote-IP
X-Remote-Addr
X-Client-IP
True-Client-IP (biasanya di Cloudflare)
```

Akan tetapi, sudah banyak aplikasi modern yang menggunakan Web Application Firewall yang menjadikan metode ini lebih sulit.

Pada cara kedua ini, asumsikan bahwa server akan mereset jumlah sisa request login (misalkan 3) salah ketika berhasil login. Hal ini dapat menjadi kelemahan bruteforce akun korban/orang lain hanya dengan setiap dua kali request (bruteforce) pastikan setelahnya untuk login ke akun kita (attacker), hal ini sebagai reset jumlah sisa request ketika salah.

***

#### User Rate Limiting

Memberikan batasan request untuk client merupakan implementasi yang cukup bagus untuk menghindari bruteforce attack, akan tetapi apabila terdapat kesalahan implementasi kode didalamnya dapat menimbulkan dampak yang buruk seperti contoh kode dibawah ini:

```javascript
app.post('/login', async (req, res) => {
    const { username, password } = req.body;

    // KESALAHAN FATAL: Mengecek apakah password itu array
    if (Array.isArray(password)) {
        // Server melakukan looping untuk mencoba semua password dalam SATU request
        for (let p of password) {
            const user = await db.findUser(username);
            const match = await bcrypt.compare(p, user.hash);
            
            if (match) {
                // Jika salah satu cocok, langsung kasih akses
                return res.json({ success: true, token: "JWT_TOKEN_HERE" });
            }
        }
        // Jika semua di array salah
        return res.status(401).json({ success: false, message: "Semua password salah" });
    } 

    // Proses login normal jika password adalah string biasa
    // ...
});
```

Pada kode di atas, attacker dapat memberikan payload yang dapat memberikan multiple password pada satu request saja seperti:

```javascript
{
    "username":"targetUsername",
    "password": [
        "password1",
        "password2",
        ...
    ]
}
```

Dengan cara ini, attacker mungkin bisa mendapatkan akses ke akun target jika terdapat salah satu password candidate yang match.
